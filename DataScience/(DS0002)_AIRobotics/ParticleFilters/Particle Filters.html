<html>
  <head>
    <!-- Normal styling from vimwiki -->
    <link rel="Stylesheet" type="text/css" href="https://albamr09.github.io/style.css" />
    <!-- Styling for search -->
    <link
      rel="Stylesheet"
      type="text/css"
      href="https://albamr09.github.io/search.css"
    />
    <title>Particle Filters</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- For LaTeX -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script
      id="MathJax-script"
      async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
    ></script>
    <!-- Code Highlight -->
    <link
      rel="Stylesheet"
      type="text/css"
      href="https://albamr09.github.io/atom-one-light.min.css"
    />
  </head>
  <body>
    <a
      href="https://albamr09.github.io/"
      style="
        color: white;
        font-weight: bold;
        text-decoration: none;
        padding: 3px 6px;
        border-radius: 3px;
        background-color: #1e90ff;
        text-transform: uppercase;
      "
      >Index</a
    >
    <form id="search_form" class="search-form">
      <input required type="search" id="search_term" class="searchTerm" />
      <button type="submit" class="searchButton">Search</button>
    </form>
    <div id="search-result" class="search-result-hide"></div>
    <hr />
    <div class="content">
<p>
<a href="../index.html">Back</a>
</p>

<div id="Particle Filters"><h1 id="Particle Filters" class="header"><a href="#Particle Filters">Particle Filters</a></h1></div>

<hr />

<div id="Particle Filters-Properties"><h2 id="Properties" class="header"><a href="#Particle Filters-Properties">Properties</a></h2></div>

<table>
<tr>
<th>
State Space
</th>
<th>
Belief
</th>
<th>
Efficiency
</th>
<th>
Accuracy
</th>
</tr>
<tr>
<td>
Continuous
</td>
<td>
Multimodal
</td>
<td>
&nbsp;
</td>
<td>
Approximate
</td>
</tr>
</table>

<div id="Particle Filters-Introduction"><h2 id="Introduction" class="header"><a href="#Particle Filters-Introduction">Introduction</a></h2></div>

<p>
So, in a first instance, given a floor plan the robot has to perform global localization. That is, it does not know where it is, and it has to find out based on sensor measurements:
</p>


<p>
<img src="./assets/particle_filter_1.png" alt="Initial State in Particle Filter" style="transform: translate(50%, 0);" />
</p>

<p>
The robot has range sensors (blue lines), which use sonar sensors (basically sound) to obtain the distance between the robot and the obstacles around it. It uses this sensors to determine a posterior distribution that models its position at a given time.
</p>

<p>
Each particle (dot) is a discrete guess whether the robot might be, and it holds the following information: x coordinate, y coordinate, and heading direction. Then, the comprise of multiple of these guesses make up the representation for the posterior of the robot's location.
</p>

<p>
So, initially the robot is completely uncertain as to where it is, which derives into a uniform distribution as to where it may be, and thus the particles are scattered all over the floor plan. However as time passes, the particle filter makes them survive according to how consistent these particles are compared to the sensor measurements:
</p>


<p>
<img src="./assets/particle_filter_2.png" alt="Update State in Particle Filter" style="width: 500px" />
<img src="./assets/particle_filter_3.png" alt="Update State in Particle Filter" style="transform: translate(10%, 0); width: 500px" />
<img src="./assets/particle_filter_4.png" alt="Update State in Particle Filter" style="transform: translate(20%, 0); width: 500px" />
</p>

<p>
In summary, the particles guess where the robot might be moving and then the filter makes them "survive" (it does not discard them) using survival of the fittest. This latter statement means that those particles that are more consistent with the measurements are more likely to survive.
</p>


<div id="Particle Filters-Importance Weight"><h2 id="Importance Weight" class="header"><a href="#Particle Filters-Importance Weight">Importance Weight</a></h2></div>

<p>
Each particle has assigned an importance weight \(w\) that determines how likely a measurement is.
</p>

<div id="Particle Filters-Resampling"><h2 id="Resampling" class="header"><a href="#Particle Filters-Resampling">Resampling</a></h2></div>

<p>
Given a total of \(N\) particles:
</p>

\begin{align}
N 
\begin{cases}
(\cdots, \cdots, \cdots)=p_1 \\
(\cdots, \cdots, \cdots)=p_2 \\
\vdots\\
(\cdots, \cdots, \cdots)=p_N \\
\end{cases}
\end{align}

<p>
Where each particle has an importance weight assigned:
</p>

\begin{align}
N 
\begin{cases}
p_1 &amp; \rightarrow w_1\\
p_2 &amp; \rightarrow w_2\\
\vdots\\
p_N &amp; \rightarrow w_N\\
\end{cases}
\end{align}

<p>
Let \(W = \sum_i w_i\) be the sum of all the weights. We introduce a new variable \(\alpha\) which represents the normalized weights:
</p>

\begin{align}
N 
\begin{cases}
p_1 &amp; \rightarrow w_1 &amp; \rightarrow \alpha_1 = \frac{w_1}{W}\\
p_2 &amp; \rightarrow w_2 &amp; \rightarrow \alpha_2 = \frac{w_2}{W}\\
\vdots\\
p_N &amp; \rightarrow w_N &amp; \rightarrow \alpha_N = \frac{w_N}{W}\\
\end{cases}
\end{align}

<p>
Hence, \(\sum_i \alpha_i = 1.0\). What resampling does is, it puts every \(\alpha_i\) into a set:
</p>

<p>
<img src="./assets/resampling_1.png" alt="Resampling" style="transform: translate(30vw, 0)" />
</p>

<p>
And then it draws with replacement a given number of elements from the set. And we pick each particle with probability \(\alpha_i\). In our case, we draw \(N\) elements from the set. Also, because we allow replacement, we can draw multiple copies of the same particle \(\p_i\):
</p>

<p>
<img src="./assets/resampling_2.png" alt="Resampling" style="height: 400px; transform: translate(30vw, 0)" />
</p>
<blockquote>
As you can see in the previous image, we have drawn three times \(p_2\), probably because the associated \(\alpha_2\) was larger than the rest of the \(\alpha\). 
</blockquote>
    
<div id="Particle Filters-Resampling-Example"><h3 id="Example" class="header"><a href="#Particle Filters-Resampling-Example">Example</a></h3></div>

<p>
Suppose we have the following data:
</p>

\begin{align}
N 
\begin{cases}
p_1 &amp; \rightarrow w_1 = 0.6 &amp; \rightarrow \alpha_1 = \frac{w_1}{W} = \frac{0.6}{6.0} = 0.1\\
p_2 &amp; \rightarrow w_2 = 1.2 &amp; \rightarrow \alpha_2 = \frac{w_2}{W} = \frac{1.2}{6.0} = 0.2\\
p_3 &amp; \rightarrow w_3 = 2.4 &amp; \rightarrow \alpha_3 = \frac{w_3}{W} = \frac{2.4}{6.0} = 0.4\\
p_4 &amp; \rightarrow w_4 = 0.6 &amp; \rightarrow \alpha_4 = \frac{w_4}{W} = \frac{0.6}{6.0} = 0.1\\
p_5 &amp; \rightarrow w_2 = 1.2 &amp; \rightarrow \alpha_5 = \frac{w_5}{W} = \frac{1.2}{6.0} = 0.2\\
\end{cases}
\end{align}

<p>
Then, the probability of never sampling \(p_3\) is given by the multiplication rule of probability:
</p>

<p>
On the first draw:
</p>

\begin{align}
P(\bar{p_3}) = P(p_1) + P(p_2) + P(p_4) + P(p_5) = 0.6
\end{align}

<p>
Because we allow for resampling, on the second draw:
</p>

\begin{align}
0.6 \cdot P(\bar{p_3}) = 0.6 \cdot (P(p_1) + P(p_2) + P(p_4) + P(p_5)) = 0.6^2
\end{align}

<p>
Thus, on the fifth and final draw:
</p>

\begin{align}
0.6^4 \cdot P(\bar{p_3}) = 0.6^4 \cdot (P(p_1) + P(p_2) + P(p_4) + P(p_5)) = 0.6^5 = 0.0777
\end{align}

<p>
However, the probabily of never drawing \(p_1\) equals:
</p>

\begin{align}
P(\bar{p_1}) = 0.9 ^ 5 = 0.59
\end{align}

<p>
Therefore, the particles with a low importance weight will survive with a much lower rate than the ones with a higher importance weight.
</p>
</div>
  </body>
  <script
    type="text/javascript"
    src="https://albamr09.github.io/highlight.min.js"
  ></script>
  <script
    type="text/javascript"
    src="https://albamr09.github.io/zepto.min.js"
  ></script>
  <script
    type="text/javascript"
    src="https://albamr09.github.io/flexsearch.bundle.js"
  ></script>
  <script
    type="text/javascript"
    src="https://albamr09.github.io/search.js"
  ></script>
  <script type="text/javascript">
    $("pre").each(function (index, item) {
      $(item).html("<code>" + $(item).html() + "</code>");
    });
    hljs.initHighlightingOnLoad();
  </script>
</html>
