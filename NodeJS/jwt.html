<!DOCTYPE html>
<html>
<head>
<link rel="Stylesheet" type="text/css" href="/home/alba/Documentos/GitRepos/Notes/style.css">
<title>jwt</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<p>
<a href="index.html">Back</a>
</p>

<div id="JSON Web Tokens"><h1 id="JSON Web Tokens" class="header"><a href="#JSON Web Tokens">JSON Web Tokens</a></h1></div>

<hr />

<div id="JSON Web Tokens-Installation"><h2 id="Installation" class="header"><a href="#JSON Web Tokens-Installation">Installation</a></h2></div>

<pre bash>

$ npm install jsonwebtoken

</pre>

<div id="JSON Web Tokens-Example of Usage"><h2 id="Example of Usage" class="header"><a href="#JSON Web Tokens-Example of Usage">Example of Usage</a></h2></div>

<p>
We first create our <code>Express</code> application and so, we import <code>express</code> and <code>jsonwebtoken</code>. And then we start the server.
</p>

<pre javascript>

const express = require("express");
const jwt = require("jsonwebtoken");

const app = express();

app.listen(3000, () =&gt; {
    console.log("nodejs app running...");
});

</pre>

<p>
Now, we define two new endpoints: <code>/api</code> and <code>/api/login</code>.
</p>

<pre javascript>

app.get("/api", (req , res) =&gt; {
    res.json({
        mensaje: "Nodejs and JWT"
    });
});

app.post("/api/login", (req , res) =&gt; {
    const user = {
        id: 1,
        nombre : "Henry",
        email: "henry@email.com"
    }

    jwt.sign({user}, 'secretkey', {expiresIn: '32s'}, (err, token) =&gt; {
        res.json({
            token
        });
    });

});

</pre>

<p>
Where we use the <code>sign</code> method to create a new token.
</p>

<p>
So, if we want to define an endpoint that requires authentication we do:
</p>

<pre javascript>

// Middleware
function verifyToken(req, res, next){
     const bearerHeader =  req.headers['authorization'];

     if(typeof bearerHeader !== 'undefined'){
          const bearerToken = bearerHeader.split(" ")[1];
          req.token  = bearerToken;
          next();
     }else{
         res.sendStatus(403);
     }
}

app.post("/api/posts", verifyToken, (req , res) =&gt; {

    jwt.verify(req.token, 'secretkey', (error, authData) =&gt; {
        if(error){
            res.sendStatus(403);
        }else{
            res.json({
                    mensaje: "Post fue creado",
                    authData
                });
        }
    });
});

</pre>

<p>
Where <code>verifyToken</code> is a middleware function that gets the token from the header, and then we use the <code>verify</code> method to check if the token is valid.
</p>

</body>
</html>
